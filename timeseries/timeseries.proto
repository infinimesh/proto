syntax = "proto3";

package infinimesh.timeseries;

import "google/api/annotations.proto";
import "google/protobuf/struct.proto";

message WriteRequest {
  string device = 1;
  string field = 2;
  google.protobuf.Value value = 3;
}

message WriteResponse {
  bool result = 1;
}

message WriteBulkRequest {
  string device = 1;
  string field = 2;
  google.protobuf.ListValue values = 3;
}

message WriteBulkResponse {
  bool result = 1;
}

message ReadRequest {
  string device = 1;
  repeated string fields = 2;
  int64 from = 3;
  optional int64 to = 4;
}

message DataPoint {
  int64 ts = 1;
  google.protobuf.Value value = 2;
}

message FieldInfo {
  string field = 1;
  repeated DataPoint data_points = 2;
}

message ReadResponse {
  repeated FieldInfo fields_info = 1;
}

message Metric {
  string device = 1;
  uint32 data_points = 2;
  DataPoint earliest = 3;
  DataPoint latest = 4;
}

message StatRequest {
  optional string namespace = 1;
  optional string device = 2;
}

message StatResponse {
  uint32 devices = 1;
  repeated Metric metrics = 2;
}

message FlushRequest {
  optional string namespace = 1;
  optional string device = 2;
}

message FlushResponse {
  bool result = 1;
}

service TimeseriesService {
  rpc Write (WriteRequest) returns (WriteResponse) {
    option (google.api.http) = {
      post: "/timeseries/{device}"
      body: "*"
    };
  };
  rpc WriteBulk (WriteRequest) returns (WriteBulkResponse) {
    option (google.api.http) = {
      post: "/timeseries/{device}/bulk"
      body: "*"
    };
  };
  rpc Read (ReadRequest) returns (ReadResponse) {
    option (google.api.http) = {
      get: "/timeseries/{device}"
    };
  };
  rpc Stat (StatRequest) returns (StatResponse) {
    option (google.api.http) = {
      get: "/timeseries"
    };
  };
  rpc Flush (FlushRequest) returns (FlushResponse) {
    option (google.api.http) = {
      delete: "/timeseries"
    };
  };
}